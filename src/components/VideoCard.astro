---
interface Props {
	title: string;
	event: string;
	year: number;
	videoUrl?: string;
	type: 'talk' | 'keynote' | 'workshop' | 'interview';
	description?: string;
}

const { title, event, year, videoUrl, type, description } = Astro.props;

// Extract video ID and platform from URL
let embedUrl = '';
let platform = '';

if (videoUrl) {
	if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
		platform = 'youtube';
		const videoId = videoUrl.includes('youtu.be')
			? videoUrl.split('youtu.be/')[1]?.split('?')[0]
			: videoUrl.split('v=')[1]?.split('&')[0];
		embedUrl = `https://www.youtube.com/embed/${videoId}`;
	} else if (videoUrl.includes('vimeo.com')) {
		platform = 'vimeo';
		const videoId = videoUrl.split('vimeo.com/')[1]?.split('?')[0];
		embedUrl = `https://player.vimeo.com/video/${videoId}`;
	}
}

const typeColors = {
	talk: 'bg-vg-red',
	keynote: 'bg-vg-burgundy',
	workshop: 'bg-vg-amber',
	interview: 'bg-vg-gray-dark',
};

const typeLabels = {
	talk: 'Conference Talk',
	keynote: 'Keynote',
	workshop: 'Hands-On Workshop',
	interview: 'Interview/Podcast',
};
---

<div class="bg-white rounded-2xl shadow-lg overflow-hidden group hover:shadow-xl transition-shadow duration-300">
	{videoUrl && embedUrl && (
		<div class="aspect-video bg-vg-gray-dark">
			<iframe
				src={embedUrl}
				title={title}
				frameborder="0"
				allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
				allowfullscreen
				class="w-full h-full"
			></iframe>
		</div>
	)}

	<div class="p-6 relative">
		<div class="flex items-center gap-2 mb-3">
			<span class={`${typeColors[type]} text-white text-xs font-semibold px-3 py-1 rounded-full`}>
				{typeLabels[type]}
			</span>
			<span class="text-vg-gray text-sm">{year}</span>
		</div>

		<h3 class="text-xl font-bold text-vg-burgundy mb-2">
			{videoUrl ? (
				<a
					href={videoUrl}
					target="_blank"
					rel="noopener noreferrer"
					class="after:absolute after:inset-0 hover:text-vg-red transition-colors"
				>
					{title}
				</a>
			) : (
				title
			)}
		</h3>

		<p class="text-vg-red font-semibold mb-3">
			{event}
		</p>

		{description && (
			<p class="text-vg-gray-dark text-sm leading-relaxed">
				{description}
			</p>
		)}

		{videoUrl && (
			<div class="mt-4 pt-4 border-t border-vg-gray-light">
				<span class="text-vg-red group-hover:text-vg-red-light font-semibold text-sm inline-flex items-center gap-2 pointer-events-none" aria-hidden="true">
					Watch on {platform === 'youtube' ? 'YouTube' : 'Vimeo'}
					<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
					</svg>
				</span>
			</div>
		)}
	</div>
</div>
