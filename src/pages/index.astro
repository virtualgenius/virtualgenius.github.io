---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import BlogPostCard from '../components/BlogPostCard.astro';
import Button from '../components/Button.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import Hero from '../components/Hero.astro';
import Icon from '../components/Icon.astro';
import ProductCard from '../components/ProductCard.astro';
import Section from '../components/Section.astro';
import ServiceCard from '../components/ServiceCard.astro';
import TestimonialCard from '../components/TestimonialCard.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = (await getCollection('blog'))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 3);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body class="bg-white">
		<Header />

		<!-- Hero Section -->
		<Hero dark>
			<div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
				<!-- Left: Text Content -->
				<div>
					<h1 class="text-5xl md:text-7xl font-bold mb-8 text-white tracking-tight leading-tight">
						EventStorming & Domain-Driven Design Consulting
					</h1>
					<p class="text-2xl md:text-3xl mb-12 text-white/90">
						Helping teams build better software through collaborative design and strategic domain modeling
					</p>
					<div class="flex flex-col sm:flex-row gap-4">
						<Button href="/workshops" variant="primary">
							View Public Workshops
						</Button>
						<Button href="/services" variant="outlined">
							Explore Services
						</Button>
					</div>
				</div>

				<!-- Right: Workshop Visual -->
				<div class="relative lg:block hidden">
					<div id="hero-container" class="relative transform lg:rotate-2 transition-none">
						<img
							id="hero-workshop-image"
							src="/images/paul-facilitating.jpg"
							alt="Paul Rayner facilitating an EventStorming workshop"
							class="w-full aspect-[4/3] object-cover rounded-3xl shadow-2xl border border-white/10 transition-opacity duration-500"
						/>
					</div>
				</div>
			</div>
			<script>
				const heroImages = [
					'/images/paul-facilitating.jpg',
					'/images/eddd-workshop.jpg',
					'/images/dddeu2020-4.jpg',
					'/images/dddeu2023-talk.png',
					'/images/bti360-participants-collaborating.jpg'
				];
				let heroCurrentIndex = 0;
				const heroImgElement = document.getElementById('hero-workshop-image');
				const heroContainerElement = document.getElementById('hero-container');

				// Debug: check computed transition on container
				if (heroContainerElement) {
					const computedStyle = window.getComputedStyle(heroContainerElement);
					console.log('Container transition property:', computedStyle.transition);
					console.log('Container transition-property:', computedStyle.transitionProperty);
					console.log('Container transition-duration:', computedStyle.transitionDuration);
				}

				setInterval(() => {
					heroCurrentIndex = (heroCurrentIndex + 1) % heroImages.length;
					if (heroImgElement && heroContainerElement) {
						console.log('Starting image change to index:', heroCurrentIndex);
						heroImgElement.style.opacity = '0';

						// Wait for image to fade out completely, THEN rotate and change image
						setTimeout(() => {
							// Alternate rotation direction using inline style (no transition)
							const rotation = heroCurrentIndex % 2 === 0 ? 'rotate(2deg)' : 'rotate(-2deg)';
							console.log('Setting rotation to:', rotation);
							heroContainerElement.style.transform = rotation;

							// Change image immediately and fade in
							heroImgElement.src = heroImages[heroCurrentIndex];
							heroImgElement.style.opacity = '1';
							console.log('Image changed and faded in');
						}, 500);
					}
				}, 5000);
			</script>
		</Hero>

		<!-- Services Overview -->
		<Section>
			<h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-vg-burgundy">Services</h2>
			<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
				<ServiceCard
					title="EventStorming Workshops"
					description="Facilitated sessions for exploring complex business domainsâ€”in-person, virtual, or hybrid"
					href="/services/eventstorming"
					linkText="Learn More"
				/>
				<ServiceCard
					title="DDD Training"
					description="Essential and Strategic Domain-Driven Design courses"
					href="/services/training"
					linkText="View Courses"
				/>
				<ServiceCard
					title="Coaching & Consulting"
					description="Ongoing support for pilot projects and implementation"
					href="/services/coaching"
					linkText="Get Started"
				/>
			</div>
		</Section>

		<!-- Client Testimonials -->
		<Section background="gray">
			<div class="text-center mb-12">
				<p class="text-sm uppercase tracking-wider mb-4 text-vg-red font-semibold">CLIENT FEEDBACK</p>
				<h2 class="text-3xl md:text-4xl font-bold text-vg-burgundy">What Clients Say</h2>
			</div>
			<div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
				<TestimonialCard
					quote="Paul certainly knew his material. He broke down processes in such a way that both technical/non-technical employees were able to digest the same material and apply it to their domain ... The course was intended to enhance the symbiotic relationship between business and tech and that it did."
					role="Workshop Participant"
					industry="Financial Services"
					rating={10}
					workshop="Applied DDD"
				/>
				<TestimonialCard
					quote="Common language used from inception to implementation, from business discussions through to code. Event storming and context mapping both powerful tools to ensure shared understanding and then to help prioritize efforts. Additional insight into Development work and how PO can help make this work easier and rally the team around shared understanding."
					role="Product Owner"
					industry="Financial Services"
					rating={10}
					workshop="Applied DDD London"
				/>
				<TestimonialCard
					quote="This has been a very engaging 3 days. I definitely like we had to work the muscles of what was trained on. I have good confidence that these principles can be used in my actual projects."
					role="Software Developer"
					industry="Financial Services"
					rating={9}
					workshop="Applied DDD"
				/>
			</div>
			<div class="text-center mt-12">
				<p class="text-lg text-vg-gray-dark mb-6">
					Average rating: <span class="font-bold text-vg-burgundy">9.2/10</span> from 583+ workshop participants
				</p>
				<a href="/testimonials" class="inline-flex items-center gap-1 text-vg-red hover:text-vg-red-light font-semibold text-lg">
					View All Testimonials
					<Icon name="arrow-right" size="sm" />
				</a>
			</div>
		</Section>

		<!-- About Paul / Why VG -->
		<Section background="white">
			<div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
				<!-- Left: Text Content -->
				<div>
					<p class="text-sm uppercase tracking-wider mb-4 text-vg-red font-semibold">LEADING BY DESIGN</p>
					<h2 class="text-4xl md:text-5xl font-bold mb-8 text-vg-burgundy tracking-tight">
						About Paul Rayner
					</h2>
					<p class="text-xl mb-6 text-vg-gray-dark leading-relaxed">
						Paul Rayner is a seasoned software design consultant, trainer, and founder of Explore DDD. With over 20 years of experience helping organizations tackle complex software challenges, Paul brings deep expertise in EventStorming, Domain-Driven Design, and collaborative modeling.
					</p>
					<p class="text-xl mb-8 text-vg-gray-dark leading-relaxed">
						His approach combines technical excellence with facilitation skills to help teams discover better solutions together.
					</p>
					<Button href="/about" variant="secondary">
						Learn More About Paul
					</Button>
				</div>

				<!-- Right: Photo with Steamhaus-style treatment -->
				<div class="relative lg:sticky lg:top-32">
					<div class="relative transform lg:rotate-2">
						<img
							src="/images/paul-portrait.jpg"
							alt="Paul Rayner"
							class="w-full aspect-[4/5] object-cover rounded-3xl shadow-2xl"
						/>
					</div>
				</div>
			</div>
		</Section>

		<!-- Explore DDD Feature -->
		<Section background="burgundy-dark">
			<div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
				<!-- Left: Text Content -->
				<div>
					<p class="text-sm uppercase tracking-wider mb-4 text-vg-amber font-semibold">COMMUNITY LEADERSHIP</p>
					<h2 class="text-4xl md:text-5xl font-bold mb-8 text-white tracking-tight leading-tight">
						Founder of Explore DDD
					</h2>
					<p class="text-xl mb-8 text-white/90 leading-relaxed">
						Explore DDD is the premier conference for Domain-Driven Design practitioners, bringing together the global DDD community to share knowledge, experiences, and insights.
					</p>
					<Button href="https://exploreddd.com" variant="outlined">
						Visit Explore DDD
					</Button>
				</div>

				<!-- Right: Conference Photo -->
				<div class="relative">
					<div class="relative transform lg:-rotate-2">
						<img
							id="homepage-eddd-image"
							src="/images/eddd-2017-workshop-1.jpg"
							alt="Explore DDD conference workshop"
							class="w-full aspect-video object-cover rounded-3xl shadow-2xl transition-opacity duration-500"
						/>
					</div>
				</div>
			</div>
			<script>
				const homepageImages = [
					'/images/eddd-2017-workshop-1.jpg',
					'/images/eddd-2017-workshop-3.jpg',
					'/images/eddd-2018-workshop-1.jpg',
					'/images/eddd-2018-workshop-2.jpg',
					'/images/eddd-2018-workshop-4.jpg',
					'/images/eddd-2018-workshop-5.jpg'
				];
				let homepageCurrentIndex = 0;
				const homepageImgElement = document.getElementById('homepage-eddd-image');

				setInterval(() => {
					homepageCurrentIndex = (homepageCurrentIndex + 1) % homepageImages.length;
					if (homepageImgElement) {
						homepageImgElement.style.opacity = '0';
						setTimeout(() => {
							homepageImgElement.src = homepageImages[homepageCurrentIndex];
							homepageImgElement.style.opacity = '1';
						}, 500);
					}
				}, 5000);
			</script>
		</Section>

		<!-- Open Source Products -->
		<Section>
			<h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-vg-burgundy">Open Source Products</h2>
			<div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
				<ProductCard
					title="ContextFlow"
					description="Visual DDD context mapper with Flow + Strategic views for analyzing bounded contexts, relationships, and code ownership"
					demoUrl="https://thepaulrayner.com/contextflow/"
					githubUrl="https://github.com/paulrayner/contextflow"
					detailsUrl="/products/contextflow"
				/>
				<ProductCard
					title="CodeCohesion"
					description="3D visualization for code cohesion and architecture evolution. Watch your codebase evolve commit-by-commit"
					demoUrl="https://thepaulrayner.com/codecohesion/"
					githubUrl="https://github.com/paulrayner/codecohesion"
					detailsUrl="/products/codecohesion"
				/>
			</div>
		</Section>

		<!-- Recent Writing -->
		{posts.length > 0 && (
			<Section background="gray">
				<h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-vg-burgundy">Recent Writing</h2>
				<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
					{posts.map((post) => (
						<BlogPostCard
							title={post.data.title}
							description={post.data.description}
							pubDate={post.data.pubDate}
							href={`/blog/${post.slug}/`}
						/>
					))}
				</div>
				<div class="text-center mt-8">
					<a href="/blog" class="inline-flex items-center gap-1 text-vg-red hover:text-vg-red-light font-semibold text-lg">
						View All Posts
						<Icon name="arrow-right" size="sm" />
					</a>
				</div>
			</Section>
		)}

		<!-- Contact CTA -->
		<Section>
			<div class="text-center max-w-3xl mx-auto">
				<h2 class="text-3xl md:text-4xl font-bold mb-6 text-vg-burgundy">
					Ready to transform your software design?
				</h2>
				<p class="text-xl mb-8 text-vg-gray-dark">
					Get in touch to discuss how EventStorming and Domain-Driven Design can help your team build better software.
				</p>
				<div class="mb-6">
					<a href="mailto:info@virtualgenius.com" class="text-2xl font-semibold text-vg-red hover:text-vg-red-light">
						info@virtualgenius.com
					</a>
				</div>
				<Button href="mailto:info@virtualgenius.com" variant="primary">
					Get in Touch
				</Button>
			</div>
		</Section>

		<Footer />
	</body>
</html>
